server:
  port: 9090

spring:
  application:
    name: demo-service-consumer

eureka:
  instance:
    prefer-ip-address: true
    instance-id: ${spring.cloud.client.ip-address}:${server.port}
    lease-renewal-interval-in-seconds: 5
    lease-expiration-duration-in-seconds: 15
    
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
    registry-fetch-interval-seconds: 5
    healthcheck:
      enabled: true

# Ribbon配置
ribbon:
  # 连接超时时间（毫秒）
  ConnectTimeout: 1000
  # 读取超时时间（毫秒）
  ReadTimeout: 3000
  # 同一实例最大重试次数（不包括首次）
  MaxAutoRetries: 0
  # 切换实例的最大次数
  MaxAutoRetriesNextServer: 2
  # 是否对所有操作都重试（默认只对GET重试）
  OkToRetryOnAllOperations: false
  # 服务列表刷新间隔（毫秒）
  ServerListRefreshInterval: 5000

# 针对特定服务的Ribbon配置
demo-service-provider:
  ribbon:
    # 可以为特定服务单独配置
    ConnectTimeout: 1000
    ReadTimeout: 3000
    MaxAutoRetries: 0
    MaxAutoRetriesNextServer: 2

# Hystrix配置
hystrix:
  command:
    default:
      execution:
        timeout:
          enabled: true
        isolation:
          thread:
            # Hystrix超时时间必须大于Ribbon总超时时间
            # Ribbon总超时 = (ConnectTimeout + ReadTimeout) × (MaxAutoRetries + 1) × (MaxAutoRetriesNextServer + 1)
            # = (1000 + 3000) × 1 × 3 = 12000ms
            timeoutInMilliseconds: 15000
      circuitBreaker:
        enabled: true
        # 触发熔断的最小请求数
        requestVolumeThreshold: 10
        # 错误率阈值（百分比）
        errorThresholdPercentage: 50
        # 熔断后多久尝试恢复（毫秒）
        sleepWindowInMilliseconds: 5000
      metrics:
        rollingStats:
          # 统计窗口时间（毫秒）
          timeInMilliseconds: 10000

# 日志配置
logging:
  level:
    com.example.consumer: INFO
    com.netflix.loadbalancer: DEBUG
    com.netflix.discovery: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{50} - %msg%n"

# Actuator配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,hystrix.stream
  endpoint:
    health:
      show-details: always
